name: changelog

on:
  release:
    types:
      - published

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Setup Ruby
        uses: ruby/setup-ruby@v1.18.0
        with:
          # Engine and version to use, see the syntax in the README. Reads from .ruby-version if unset.
          ruby-version: 2.6.5
      - name: Install and run github_changelog_generator
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gem install github_changelog_generator
          github_changelog_generator -u dcsil -p csc491 -t $GITHUB_TOKEN
      - name: Commit files
        env:
          REPO_ACCESS_TOKEN: ${{ secrets.REPO_ACCESS_TOKEN }}
        run: |
          git checkout -B master origin/master
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git remote set-url origin https://jules2689:$REPO_ACCESS_TOKEN@github.com/dcsil/csc491.git
          git add --all .
          git commit -m "Update CHANGELOG"
          git push origin master
          
