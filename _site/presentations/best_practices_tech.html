<h1 id="best-practices-technology-and-tooling">Best Practices, Technology, and Tooling</h1>

<h2 id="csc491-university-of-toronto">CSC491, University of Toronto</h2>

<hr />

<h1 id="what-are-best-practices">What are best practices?</h1>

<blockquote>
  <p>commercial or professional procedures that are accepted or prescribed as being correct or most effective.</p>
</blockquote>

<hr />

<h1 id="what-are-best-practices-1">What are best practices?</h1>

<p>There are so many opinions on this topic that none of them are right. This lecture will cover some pro-tips on how to naviate this field</p>

<hr />

<h1 id="high-level-agenda">High Level Agenda</h1>

<p>1) We will not go in depth on any topic as there are many many options and that would not be feasible
2) I intend to introduce you to the concepts and provide some examples
3) You should leave here understanding a breadth of options and understand new concepts
4) I will help you evaluate and pick options if required for your projects
5) I can answer questions based on my own experiences and opinions, but remember these are not the “correct” solution</p>

<hr />

<h1 id="high-level-agenda-1">High Level Agenda</h1>

<ul>
  <li>Testing
    <ul>
      <li>The different types of tests</li>
      <li>When to reach for what</li>
      <li>Code Coverage</li>
    </ul>
  </li>
  <li>Linting &amp; Semantic Analysis</li>
</ul>

<hr />

<h1 id="high-level-agenda-2">High Level Agenda</h1>

<ul>
  <li>Technologies
    <ul>
      <li>Continuous Integration and Deployment (CI/CD, Circle, Travis, GitHub Actions)</li>
      <li>Databases (MySQL, Postgres, etc)</li>
      <li>Caching (Redis, Memcache, etc)</li>
      <li>Languages (Ruby, Python, Javascript, PHP, Java, C, C++, Rust, Golang, R, etc)</li>
      <li>Instructure (Docker, Kubernetes, Metal)</li>
      <li>Orchestration (Packer, Chef, Puppet, etc)</li>
    </ul>
  </li>
  <li>Local Developer Environments
    <ul>
      <li>Developer Productivity</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="preface">Preface</h1>

<p>Each of the following topics evolve with your company. What you need now does not match what you need in the future. This is a constantly changing area.</p>

<p>If you’re lucky, you’ll end up with a full department dedicated to these areas</p>

<hr />

<h1 id="testing">Testing</h1>

<h2 id="different-types-of-tests">Different Types of Tests</h2>

<p>This list is not exhaustive.</p>

<h4 id="functional-testing--unit-tests">Functional testing : Unit Tests</h4>

<p>A test written on a module of code or software component. Tests that inputs gives expected outputs.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">test_add</span>
  <span class="n">assert_equal</span> <span class="mi">5</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<hr />

<h1 id="testing-1">Testing</h1>

<h4 id="functional-testing--integration-tests">Functional testing : Integration Tests</h4>

<p>Test the integration of multiple components to ensure they work correctly (e.g. calling API goes to controller and renders properly)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="no">Person</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">to_h</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">test_index</span>
  <span class="n">get</span> <span class="s2">"/my_controller.json"</span>
  <span class="n">assert_response</span> <span class="ss">:success</span>
  <span class="n">assert_equal</span> <span class="p">[{</span> <span class="ss">name: </span><span class="s2">"Jane Doe"</span> <span class="p">}],</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<hr />

<h1 id="testing-2">Testing</h1>

<h4 id="functional-testing--smoke-or-acceptance-tests">Functional testing : Smoke or Acceptance Tests</h4>

<p>Manual validation of a product or software by humans. Sometimes performed by dedicated “testers”</p>

<hr />

<h1 id="testing-3">Testing</h1>

<h4 id="functional-testing--ui-screenshot-visual-regression-tests">Functional testing : UI, Screenshot, Visual Regression Tests</h4>

<p>The use of automated image diffing software to determine if an image changed. Usually used by generating a screenshot of your rendered software.</p>

<p><img src="./img/tech_best_practices/screenshot_test.png" alt="legend:Visual Regression test showing a change in the UI. Borrowed from https://learn.visualregressiontesting.com height:400px" /></p>

<hr />

<h1 id="testing-4">Testing</h1>

<h4 id="functional-testing--regression-tests">Functional testing : Regression Tests</h4>

<p>Can refer to a full scale manual smoke test of an app, or an automated test targeting a specific bug</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_person_name</span>
  <span class="n">assert_equal</span> <span class="s2">"Jane Doe"</span><span class="p">,</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">name</span>
  <span class="c1"># There was a bug that wouldnt correctly render accented latin characters</span>
  <span class="n">assert_equal</span> <span class="s2">"Sébastien Trudeau"</span><span class="p">,</span> <span class="vi">@french_person</span><span class="p">.</span><span class="nf">name</span>

  <span class="c1"># There was a bug that wouldnt correctly render Chinese characters</span>
  <span class="n">assert_equal</span> <span class="s2">"孫載之"</span><span class="p">,</span> <span class="vi">@chinese_person</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre></div></div>

<hr />

<h1 id="testing-5">Testing</h1>

<h4 id="functional-testing--system-tests">Functional testing : System Tests</h4>

<p>Automated testing of the system as a whole. Tend to be slow, but especially useful for critical code paths like sign in</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sign_in_flow</span>
  <span class="c1"># Server is started automatically</span>
  <span class="n">go_to</span> <span class="s2">"/sign_in"</span>

  <span class="n">click</span> <span class="s2">"Email"</span>
  <span class="n">type</span> <span class="s2">"jack@example.com"</span>

  <span class="n">click</span> <span class="s2">"Password"</span>
  <span class="n">type</span> <span class="s2">"123456a!"</span>

  <span class="n">click</span> <span class="s2">"Sign in"</span>

  <span class="n">assert_text</span> <span class="s2">"Welcome jack@example.com"</span>
<span class="k">end</span>
</code></pre></div></div>

<hr />

<h1 id="testing-6">Testing</h1>

<h4 id="non-functional-testing--performance-tests">Non-Functional testing : Performance Tests</h4>

<p>Testing of the systems performance. Can use dumps of the garbage collection, current system state, determine how long something takes</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_an_expensive_method</span>
  <span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
  <span class="n">do_an_expensive_thing</span>
  <span class="n">delta</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">-</span> <span class="n">t</span>
  <span class="n">assert</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="c1"># 10 seconds</span>
<span class="k">end</span>
</code></pre></div></div>

<hr />

<h1 id="testing-7">Testing</h1>

<h4 id="non-functional-testing--load-tests">Non-Functional testing : Load Tests</h4>

<p>Test how much load a system can take on various paths. E.g. can I send 1 million requests per minute? per second? to <action></action></p>

<p><img src="./img/tech_best_practices/locust_io.png" alt="legend:UI of Locust.io an OSS load testing framework. Borrowed from https://locust.io/ height:400px" /></p>

<hr />

<h1 id="testing-8">Testing</h1>

<h4 id="non-functional-testing--security-tests">Non-Functional testing : Security Tests</h4>

<p>The use of pentesting, hacking, semantic analysis and other methods to determine if unauthorized access can be gained into a system. This can be XSS, SQL Injection, Memory Buffer Leaks, and more.</p>

<hr />

<h1 id="testing-9">Testing</h1>

<h2 id="code-coverage">Code Coverage</h2>

<blockquote>
  <p>measure used to describe the degree to which the source code of a program is executed when a particular test suite runs</p>
</blockquote>

<p>Aka when I run my tests, what percentage of lines of code in my app are hit?</p>

<hr />

<h1 id="testing-10">Testing</h1>

<h2 id="code-coverage-1">Code Coverage</h2>

<p>What percent coverage should you aim for?</p>

<hr />

<h1 id="linting">Linting</h1>

<blockquote>
  <p>lint, or a linter, is a tool that analyzes source code to flag programming errors, bugs, stylistic errors, and suspicious constructs.</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/src/github.com/dcsil/team-app<span class="o">(</span>master<span class="o">)</span> ➜ rubocop
Inspecting 61 files
...........C.C................C..................CC.CCC...WC.

Offenses:

app/models/student.rb:24:42: C: Layout/ExtraSpacing: Unnecessary spacing detected.
  attr_accessor :skip_password_validation  <span class="c"># virtual attribute to skip password validation while saving</span>
                                         ^
</code></pre></div></div>

<hr />

<h1 id="linting-1">Linting</h1>

<ul>
  <li>Saves time on the boring stuff (who wants to debate how many spaces to put after a <code class="highlighter-rouge">{</code>?)</li>
  <li>Consistent Code. Code is your UI. This makes your devs faster because the code is easier to read</li>
  <li>Can catch bugs</li>
</ul>

<hr />

<h1 id="linting-2">Linting</h1>

<p>Can also help a developer do the “right” thing!</p>

<p>Linting can ensure proper use of methods in OSS repos, for example.</p>

<hr />

<h1 id="semantic-analysis">Semantic Analysis</h1>

<blockquote>
  <p>Semantic analysis or context sensitive analysis is a process in compiler construction, usually after parsing, to gather necessary semantic information from the source code.</p>
</blockquote>

<p>Includes such things as type checking too.</p>

<hr />

<h1 id="semantic-analysis-1">Semantic Analysis</h1>

<ul>
  <li>Catch bugs</li>
  <li>Catch security issues</li>
</ul>

<p><img src="./img/tech_best_practices/semantic.png" alt="legend:Example of Semmle, a semantic analysis tool, in action height:400px" /></p>

<hr />

<h1 id="continuous-integration-ci">Continuous Integration (CI)</h1>

<h3 id="overview-of-how-it-works">Overview of how it works</h3>

<p>When code is pushed to a remote repository, a system picks up the changes, clones them, runs the test suite, and reports the result to the code.</p>

<hr />

<h1 id="continuous-integration-ci-1">Continuous Integration (CI)</h1>

<h3 id="parts-of-a-ci-system">Parts of a CI System</h3>

<p>The basic parts of a CI system are:</p>

<ol>
  <li>Event System
    <ul>
      <li>Receives events from some remote source indicating a code change</li>
    </ul>
  </li>
  <li>Scheduling system
    <ul>
      <li>Schedules the job to be run</li>
    </ul>
  </li>
  <li>Coordinator
    <ul>
      <li>Coordinates workers to run a job. Sometimes will check out the code and create a cached setup for the workers.</li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="continuous-integration-ci-2">Continuous Integration (CI)</h1>

<h3 id="parts-of-a-ci-system-1">Parts of a CI System</h3>

<ol>
  <li>Workers
    <ul>
      <li>Checks out the code if not done in (3) and sets it up. Runs the test suite (or part of it)</li>
    </ul>
  </li>
  <li>Reporter
    <ul>
      <li>Aggregates any results and reports back to the source of the code change</li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="continuous-integration-ci-3">Continuous Integration (CI)</h1>

<h3 id="parts-of-a-ci-system-2">Parts of a CI System</h3>

<ul>
  <li>We also need a UI to see the CI running and stream logs in real time</li>
  <li>We can sometimes need a test flakiness* detection system</li>
</ul>

<p><code class="highlighter-rouge">*</code> test flakiness occurs when a test, that should pass, fails some of the time for unrelated reasons. This could be due to performance issues of the system, time based issues, or something else unknown.</p>

<hr />

<h1 id="continuous-integration-ci-4">Continuous Integration (CI)</h1>

<h4 id="setup-time">Setup time</h4>

<ul>
  <li>As your test suite grows so does the time required to run it.</li>
  <li>To combat this people often split their tests between multiple workers.</li>
  <li>Each of those workers has some fixed set up time.</li>
</ul>

<hr />

<h1 id="continuous-integration-ci-5">Continuous Integration (CI)</h1>

<h4 id="setup-time-1">Setup time</h4>

<ul>
  <li>E.g. If you have 20 workers that run 30 minute of tests each but each takes 3.5 minutes to setup, then it still takes 4 minutes. It would be just as cost effective and almost the same time to halve the workers in this case.</li>
  <li>Work on reducing set up time by prebuilding an image, sharing a cache between builds (of packages for example), or having one setup done in a coordinator</li>
</ul>

<hr />

<h1 id="continuous-deployment-cd">Continuous Deployment (CD)</h1>

<ul>
  <li>Fast, debuggable deploy</li>
  <li>Somewhere everyone can see, so many can debug if problems</li>
  <li>Coordinated deploys are easier</li>
</ul>

<hr />

<h1 id="continuous-deployment-cd-1">Continuous Deployment (CD)</h1>

<p><img src="./img/tech_best_practices/shipit.webp" alt="legend:Shipit, a Shopify application, that is used to coordinate deploys" /></p>

<hr />

<h1 id="continuous-deployment-cd-2">Continuous Deployment (CD)</h1>

<p><img src="./img/tech_best_practices/shipit2.webp" alt="legend:Shipit, a Shopify application, that is used to coordinate deploys height:400" /></p>

<hr />

<h1 id="databases">Databases</h1>

<ul>
  <li>Examples include:
    <ul>
      <li>MySQL</li>
      <li>Postgres</li>
      <li>MongoDB</li>
      <li>CockroachDB</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="databases-1">Databases</h1>

<ul>
  <li>Choose one based on industry, E.g. what part of ACID is important to you?
    <ul>
      <li>MongoDB is know to have poor data durability for example, so would be poor for Fintech or other industries where data durability is important</li>
    </ul>
  </li>
  <li>What expertise do you have in the company?</li>
</ul>

<hr />

<h1 id="caching">Caching</h1>

<ul>
  <li>Examples include: Redis and Memcache</li>
  <li>Depends on your use case.
    <ul>
      <li>Example: Redis is good for smaller datasets and can use 1 core</li>
      <li>Example: Memcached is better on a larger dataset, worse per-core performance, but can use multiple cores</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="languages">Languages</h1>

<ul>
  <li>Examples include:
    <ul>
      <li>Ruby</li>
      <li>Python</li>
      <li>Javascript</li>
      <li>PHP</li>
      <li>Java</li>
      <li>C</li>
      <li>C++</li>
      <li>Rust</li>
      <li>Golang</li>
      <li>R</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="how-to-pick-a-programming-language">How to pick a Programming Language</h1>

<p>1) What are they good at? Web? System? FED? OS?
2) Is the community and the community tooling good?
3) Can you hire for it? aka is it a top language</p>

<hr />

<h1 id="top-languages">Top Languages</h1>

<p>GitHub Report showing top languages over time:</p>

<p><img src="./img/tech_best_practices/top_languages.png" alt="legend:GitHub Report showing top 10 lanugages over time height:500" /></p>

<hr />

<h1 id="fastest-growing-languages">Fastest Growing Languages</h1>

<p>GitHub Report showing fastest growing languages:</p>

<p><img src="./img/tech_best_practices/fastest_growing_languages.png" alt="legend:GitHub Report showing fastest growing languages height:500" /></p>

<hr />

<h1 id="instructure">Instructure</h1>

<h3 id="how-do-we-host-our-apps">How do we host our apps?</h3>

<hr />

<h1 id="infrastructure">Infrastructure</h1>

<ul>
  <li>Web apps are typically hosted using Docker, Kubernetes, or on “Bare Metal”</li>
  <li>ML and AI are typically hosted on a platform like <a href="https://www.atlas.dessa.com/">Dessa’s Atlas</a> or your own data warehouses</li>
  <li>Other services like datastores are often hosted like web apps using orchestration software</li>
</ul>

<hr />

<h1 id="infratrucutre">Infratrucutre</h1>

<p>Personal Opinion:</p>

<ul>
  <li>Bare metal is usually most performant, but it is harder to manage</li>
  <li>Docker is nice as it makes an easily reproducible environment</li>
  <li>Kubernetes is often overkill until you have enough servers for it to matter</li>
  <li>A platform like Heroku is great to start because you don’t have to worry about this stuff at all</li>
</ul>

<hr />

<h1 id="orchestration">Orchestration</h1>

<p>Examples include Packer, Chef, and Puppet</p>

<ul>
  <li>Manage many systems as code, idempotent changes, version control config</li>
  <li>Easy to run and manage many things at once</li>
</ul>

<hr />

<h1 id="orchestration-1">Orchestration</h1>

<p>Packer example:</p>

<p><img src="./img/tech_best_practices/packer.png" alt="legend:Packer configuration height:400" /></p>

<hr />

<h1 id="local-developer-environments">Local Developer Environments</h1>

<ul>
  <li>How will you run your app locally?</li>
  <li>How will the next person?</li>
  <li>What is the experience like running your app locally?</li>
</ul>

<hr />

<h1 id="local-developer-environments-1">Local Developer Environments</h1>

<ul>
  <li>Running your app locally often starts as a set of instructions in a doc somewhere</li>
  <li>Eventually it makes its way into an automated script when other people start wanting to run your software</li>
  <li>Many people eventually make Docker containers out of it</li>
  <li>Then they realize they need 10 Docker containers to run stuff locally and need to network into the Docker container to change files</li>
</ul>

<hr />

<h1 id="local-developer-environments-2">Local Developer Environments</h1>

<ul>
  <li>Not an easy task. Just as hard as production.</li>
  <li>Docker-Compose is a good start, may need to write code outside of the container and sync in?</li>
  <li>In Cloud options becoming more viable</li>
</ul>

<hr />

<h1 id="local-developer-experience">Local Developer Experience</h1>

<ul>
  <li>The local developer experience should be something you don’t take for granted.</li>
  <li>While saving a few minutes of time on a script or task might seem meaningless, imagine the time saved when you have to do that task 100 times. Imagine the time saved when 100 people have to do the task 100 times.</li>
  <li><a href="https://www.notion.so/jnadeau/Developer-Productivity-37a01aed957a44b8ad20cb2a297d6c01">I have written a lot about this here</a></li>
</ul>

<hr />

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="https://www.softwaretestinghelp.com/types-of-software-testing/">Types of Software Testing</a></li>
  <li><a href="https://learn.visualregressiontesting.com">Visual Regression Testing</a></li>
  <li><a href="https://locust.io/">Locust.io</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Lint_(software)">Lint (Software)</a></li>
  <li><a href="https://lgtm.com/projects/g/ampproject/amphtml/snapshot/14823e4d72668cf89932b8ede8895830a18cd3f9/files/build-system/app.js?sort=name&amp;dir=ASC&amp;mode=heatmap">LGTM from Semmle Example</a></li>
  <li><a href="https://medium.com/@Alibaba_Cloud/redis-vs-memcached-in-memory-data-storage-systems-3395279b0941">Redis vs Memcached</a></li>
  <li><a href="https://octoverse.github.com/">GitHub report on top languages</a></li>
  <li><a href="https://www.notion.so/jnadeau/Developer-Productivity-37a01aed957a44b8ad20cb2a297d6c01">Developer Productivity</a></li>
</ul>
